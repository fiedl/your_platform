rvm:
  - "2.6.2"
env:
  - "WORKER_ID=0   NUMBER_OF_WORKERS=1 CI_CATEGORY=features RAILS_ENV=test CI=travis COVERALLS_SILENT=true NEO4J_REST_URL_TEST=http://neo4j:neo4j@localhost:7474 DB=mysql SELENIUM=true"
cache:
  bundler: true
  directories:
    - node_modules
  yarn: true
dist: trusty
sudo: true
addons:
  firefox: latest
  chrome: stable
  apt:
    packages:
      - pwgen
      - libicu-dev
services:
  - redis-server
  - elasticsearch
  - neo4j
before_install:
  - travis_retry gem update --system
  - travis_retry gem install bundler
  - wget https://github.com/mozilla/geckodriver/releases/download/v0.24.0/geckodriver-v0.24.0-linux64.tar.gz
  - mkdir geckodriver
  - tar -xzf geckodriver*.tar.gz -C geckodriver
  - export PATH=$PATH:$PWD/geckodriver
install:
  - travis_retry bundle install
  - bundle install
  - nvm install v10.16.0
  - node -v
  - npm i -g yarn
  - yarn
before_script:
  - sleep 10
  - cd demo_app/my_platform
  - cp config/database.travis.yml config/database.yml
  - cp config/secrets.example.yml config/secrets.yml
  - mkdir -p public/uploads
  - mkdir -p tmp/cache
  - bundle exec rake db:create db:migrate
  - bundle exec rake your_platform:install:node_modules || echo 'task not found'
  - bin/rails assets:precompile
  - cd ../..
  - "export DISPLAY=:99.0" # https://docs.travis-ci.com/user/gui-and-headless-browsers/#Using-xvfb-to-Run-Tests-That-Require-a-GUI
  - "sh -e /etc/init.d/xvfb start --server-args='-screen 0 1024x768x24'"
  - sleep 3 # give xvfb some time to start
script:
  - bin/rspec spec/features/search_field_spec.rb:85
notifications:
  webhooks:
    urls:
      - https://webhooks.gitter.im/e/14aec2cb97b9e0f2a808
    on_success: always  # options: [always|never|change] default: always
    on_failure: always  # options: [always|never|change] default: always
    on_start: false     # default: false

