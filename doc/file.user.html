<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>
  File: user
  
    &mdash; Documentation by YARD 0.8.5.2
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '';
  framesUrl = "frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: user</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><div id='filecontents'><pre class="code ruby"><span class='comment'># -*- coding: utf-8 -*-
</span><span class='kw'>class</span> <span class='const'>User</span> <span class='op'>&lt;</span> <span class='const'>ActiveRecord</span><span class='op'>::</span><span class='const'>Base</span>

  <span class='id identifier rubyid_attr_accessible'>attr_accessible</span>           <span class='symbol'>:first_name</span><span class='comma'>,</span> <span class='symbol'>:last_name</span><span class='comma'>,</span> <span class='symbol'>:name</span><span class='comma'>,</span> <span class='symbol'>:alias</span><span class='comma'>,</span> <span class='symbol'>:email</span><span class='comma'>,</span> <span class='symbol'>:create_account</span><span class='comma'>,</span> <span class='symbol'>:female</span><span class='comma'>,</span> <span class='symbol'>:add_to_group</span><span class='comma'>,</span> <span class='symbol'>:date_of_birth</span>

  <span class='id identifier rubyid_attr_accessor'>attr_accessor</span>             <span class='symbol'>:create_account</span><span class='comma'>,</span> <span class='symbol'>:add_to_group</span>
  <span class='comment'># Boolean, der vormerkt, ob dem (neuen) Benutzer ein Account hinzugef√ºgt werden soll.
</span>
  <span class='id identifier rubyid_validates_presence_of'>validates_presence_of</span>     <span class='symbol'>:first_name</span><span class='comma'>,</span> <span class='symbol'>:last_name</span>
  <span class='id identifier rubyid_validates_uniqueness_of'>validates_uniqueness_of</span>   <span class='symbol'>:alias</span><span class='comma'>,</span> <span class='symbol'>:if</span> <span class='op'>=&gt;</span> <span class='const'>Proc</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_user'>user</span><span class='op'>|</span> <span class='op'>!</span> <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_alias'>alias</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_validates_format_of'>validates_format_of</span>       <span class='symbol'>:email</span><span class='comma'>,</span> <span class='symbol'>:with</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^[a-z0-9_.-]+@[a-z0-9-]+\.[a-z.]+$</span><span class='regexp_end'>/i</span></span><span class='comma'>,</span> <span class='symbol'>:if</span> <span class='op'>=&gt;</span> <span class='const'>Proc</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_user'>user</span><span class='op'>|</span> <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_email'>email</span> <span class='rbrace'>}</span>

  <span class='id identifier rubyid_has_profile_fields'>has_profile_fields</span>

  <span class='id identifier rubyid_has_one'>has_one</span>                   <span class='symbol'>:account</span><span class='comma'>,</span> <span class='label'>class_name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UserAccount</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>autosave:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>inverse_of:</span> <span class='symbol'>:user</span><span class='comma'>,</span> <span class='label'>dependent:</span> <span class='symbol'>:destroy</span>
  <span class='id identifier rubyid_validates_associated'>validates_associated</span>      <span class='symbol'>:account</span>

  <span class='id identifier rubyid_is_structureable'>is_structureable</span>          <span class='label'>ancestor_class_names:</span> <span class='qwords_beg'>%w(</span><span class='tstring_content'>Page</span><span class='words_sep'> </span><span class='tstring_content'>Group</span><span class='words_sep'>)</span><span class='comma'>,</span> <span class='label'>descendant_class_names:</span> <span class='qwords_beg'>%w(</span><span class='tstring_content'>Page</span><span class='words_sep'>)</span>

  <span class='id identifier rubyid_has_many'>has_many</span>                  <span class='symbol'>:relationships_as_first_user</span><span class='comma'>,</span> <span class='label'>foreign_key:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>user1_id</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>class_name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Relationship</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>dependent:</span> <span class='symbol'>:destroy</span><span class='comma'>,</span> <span class='label'>inverse_of:</span> <span class='symbol'>:user1</span>

  <span class='id identifier rubyid_has_many'>has_many</span>                  <span class='symbol'>:relationships_as_second_user</span><span class='comma'>,</span> <span class='label'>foreign_key:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>user2_id</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>class_name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Relationship</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>dependent:</span> <span class='symbol'>:destroy</span><span class='comma'>,</span> <span class='label'>inverse_of:</span> <span class='symbol'>:user2</span>
  
  <span class='id identifier rubyid_has_many'>has_many</span>                  <span class='symbol'>:bookmarks</span>

  <span class='id identifier rubyid_is_navable'>is_navable</span>

  <span class='id identifier rubyid_before_save'>before_save</span>               <span class='symbol'>:generate_alias_if_necessary</span><span class='comma'>,</span> <span class='symbol'>:capitalize_name</span><span class='comma'>,</span> <span class='symbol'>:write_alias_attribute</span>
  <span class='id identifier rubyid_before_save'>before_save</span>               <span class='symbol'>:build_account_if_requested</span>
  <span class='id identifier rubyid_after_save'>after_save</span>                <span class='symbol'>:add_to_group_if_requested</span>


  <span class='comment'># General Properties
</span>  <span class='comment'># ==========================================================================================
</span>
  <span class='comment'># The name of the user, i.e. first_name and last_name.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_name'>name</span>
    <span class='id identifier rubyid_first_name'>first_name</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_last_name'>last_name</span>
  <span class='kw'>end</span>

  <span class='comment'># This method will make the first_name and the last_name capitalized.
</span>  <span class='comment'># For example:
</span>  <span class='comment'>#
</span>  <span class='comment'>#   @user = User.create( first_name: &quot;john&quot;, last_name: &quot;doe&quot;, ... )
</span>  <span class='comment'>#   @user.capitalize_name  # =&gt; &quot;John Doe&quot;
</span>  <span class='comment'>#   @user.save
</span>  <span class='comment'>#   @user.name  # =&gt; &quot;John Doe&quot;
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_capitalize_name'>capitalize_name</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_first_name'>first_name</span> <span class='op'>=</span> <span class='id identifier rubyid_capitalized_name_string'>capitalized_name_string</span><span class='lparen'>(</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_first_name'>first_name</span> <span class='rparen'>)</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_last_name'>last_name</span> <span class='op'>=</span> <span class='id identifier rubyid_capitalized_name_string'>capitalized_name_string</span><span class='lparen'>(</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_last_name'>last_name</span> <span class='rparen'>)</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_capitalized_name_string'>capitalized_name_string</span><span class='lparen'>(</span> <span class='id identifier rubyid_name_string'>name_string</span> <span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_name_string'>name_string</span> <span class='kw'>if</span> <span class='id identifier rubyid_name_string'>name_string</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span> <span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_name_string'>name_string</span><span class='period'>.</span><span class='id identifier rubyid_slice'>slice</span><span class='lparen'>(</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_capitalize'>capitalize</span> <span class='op'>+</span> <span class='id identifier rubyid_name_string'>name_string</span><span class='period'>.</span><span class='id identifier rubyid_slice'>slice</span><span class='lparen'>(</span> <span class='int'>1</span> <span class='op'>..</span> <span class='op'>-</span><span class='int'>1</span> <span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_private'>private</span> <span class='symbol'>:capitalized_name_string</span>

  <span class='comment'># This method returns a kind of label for the user, e.g. for menu items representing the user.
</span>  <span class='comment'># Use this rather than the name attribute itself, since the title method is likely to be overridden
</span>  <span class='comment'># in the main application.
</span>  <span class='comment'># Notice: This method does *not* return the academic title of the user.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_title'>title</span>
    <span class='id identifier rubyid_name'>name</span>
  <span class='kw'>end</span>

  <span class='comment'># This accessors allow to access the gender of the user rather than just asking if the
</span>  <span class='comment'># user is female as allowed by the ActiveRecord accessor.
</span>  <span class='comment'># (:female is a boolean column in the users table.)
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_gender'>gender</span>
    <span class='kw'>return</span> <span class='symbol'>:female</span> <span class='kw'>if</span> <span class='id identifier rubyid_female?'>female?</span>
    <span class='kw'>return</span> <span class='symbol'>:male</span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_gender='>gender=</span><span class='lparen'>(</span> <span class='id identifier rubyid_new_gender'>new_gender</span> <span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_new_gender'>new_gender</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>female</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_female'>female</span> <span class='op'>=</span> <span class='kw'>true</span>
    <span class='kw'>else</span>
      <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_female'>female</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># Date of Birth
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_date_of_birth'>date_of_birth</span>
    <span class='id identifier rubyid_date_of_birth_profile_field'>date_of_birth_profile_field</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span><span class='period'>.</span><span class='id identifier rubyid_to_date'>to_date</span> <span class='kw'>if</span> <span class='id identifier rubyid_date_of_birth_profile_field'>date_of_birth_profile_field</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span> <span class='kw'>if</span> <span class='id identifier rubyid_date_of_birth_profile_field'>date_of_birth_profile_field</span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_date_of_birth='>date_of_birth=</span><span class='lparen'>(</span> <span class='id identifier rubyid_date_of_birth'>date_of_birth</span> <span class='rparen'>)</span>
    <span class='id identifier rubyid_date_of_birth_profile_field'>date_of_birth_profile_field</span>
    <span class='ivar'>@date_of_birth_profile_field</span> <span class='op'>||=</span> <span class='id identifier rubyid_profile_fields'>profile_fields</span><span class='period'>.</span><span class='id identifier rubyid_build'>build</span><span class='lparen'>(</span> <span class='label'>type:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ProfileFieldTypes::Date</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>label:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>date_of_birth</span><span class='tstring_end'>&#39;</span></span> <span class='rparen'>)</span>
    <span class='ivar'>@date_of_birth_profile_field</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='id identifier rubyid_date_of_birth'>date_of_birth</span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_date_of_birth_profile_field'>date_of_birth_profile_field</span>
    <span class='ivar'>@date_of_birth_profile_field</span> <span class='op'>||=</span> <span class='id identifier rubyid_profile_fields'>profile_fields</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span> <span class='label'>type:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ProfileFieldTypes::Date</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>label:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>date_of_birth</span><span class='tstring_end'>&#39;</span></span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_limit'>limit</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
  <span class='kw'>end</span>

  <span class='comment'># Associated Objects
</span>  <span class='comment'># ==========================================================================================
</span>
  <span class='comment'># Alias
</span>  <span class='comment'># ------------------------------------------------------------------------------------------
</span>
  <span class='comment'># The UserAlias class inherits from String, but has some more methods, e.g. a method
</span>  <span class='comment'># to generate a new alias from other user attributes. To make sure that `alias` returns
</span>  <span class='comment'># an object of UserAlias type, the accessor methods are overridden here.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>alias</span>
    <span class='ivar'>@alias</span> <span class='op'>=</span> <span class='const'>UserAlias</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span> <span class='id identifier rubyid_read_attribute'>read_attribute</span><span class='lparen'>(</span> <span class='symbol'>:alias</span> <span class='rparen'>)</span><span class='comma'>,</span> <span class='symbol'>:user</span> <span class='op'>=&gt;</span> <span class='kw'>self</span> <span class='rparen'>)</span> <span class='kw'>unless</span> <span class='ivar'>@alias</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span> <span class='const'>UserAlias</span>
    <span class='kw'>return</span> <span class='ivar'>@alias</span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_alias='>alias=</span><span class='lparen'>(</span> <span class='id identifier rubyid_a'>a</span> <span class='rparen'>)</span>
    <span class='ivar'>@alias</span> <span class='op'>=</span> <span class='id identifier rubyid_a'>a</span>
    <span class='id identifier rubyid_write_alias_attribute'>write_alias_attribute</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_write_alias_attribute'>write_alias_attribute</span>
    <span class='id identifier rubyid_write_attribute'>write_attribute</span> <span class='symbol'>:alias</span><span class='comma'>,</span> <span class='ivar'>@alias</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_private'>private</span> <span class='symbol'>:write_alias_attribute</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_generate_alias_if_necessary'>generate_alias_if_necessary</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_alias'>alias</span><span class='period'>.</span><span class='id identifier rubyid_generate!'>generate!</span> <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_alias'>alias</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_private'>private</span> <span class='symbol'>:generate_alias_if_necessary</span>


  <span class='comment'># User Account
</span>  <span class='comment'># ------------------------------------------------------------------------------------------
</span>
  <span class='comment'># A user stored in the database does not necessarily possess the right to log in, i.e.
</span>  <span class='comment'># have a user account. This method allows to find out whether the user has got an
</span>  <span class='comment'># active user account.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_has_account?'>has_account?</span>
    <span class='kw'>return</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_account'>account</span>
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>end</span>

  <span class='comment'># This method activates the user account, i.e. grants the user the right to log in.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_activate_account'>activate_account</span>
    <span class='kw'>unless</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_account'>account</span>
      <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_account'>account</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_build_account'>build_account</span>
      <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># This method deactivates the user account, i.e. destroys the associated object
</span>  <span class='comment'># and prevents the user from logging in.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_deactivate_account'>deactivate_account</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>no user account exists, therefore it can&#39;t be destroyed.</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_account'>account</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_account'>account</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_account'>account</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>

  <span class='comment'># If the attribute `create_account` is set to `true` or to `1`, e.g. by an html form,
</span>  <span class='comment'># this code makes sure that the account association is build.
</span>  <span class='comment'># This code is run on validation, as you can see above in this model.
</span>  <span class='comment'># Note: A welcome email is automatically sent on save by the UserAccount model.
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_build_account_if_requested'>build_account_if_requested</span>

    <span class='comment'># If this value is set by an html form, it is &quot;0&quot; or &quot;1&quot;. But &quot;0&quot; would
</span>    <span class='comment'># transform to true rather than to false.
</span>    <span class='comment'># Thus, we have to make sure that &quot;0&quot; means false.
</span>    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_create_account'>create_account</span> <span class='op'>=</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_create_account'>create_account</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>0</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_create_account'>create_account</span> <span class='op'>=</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_create_account'>create_account</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_create_account'>create_account</span> <span class='op'>=</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_create_account'>create_account</span> <span class='op'>==</span> <span class='int'>0</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_create_account'>create_account</span> <span class='op'>=</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_create_account'>create_account</span> <span class='op'>==</span> <span class='int'>1</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_create_account'>create_account</span> <span class='op'>=</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_create_account'>create_account</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>

    <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_create_account'>create_account</span> <span class='op'>==</span> <span class='kw'>true</span>
      <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_account'>account</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span> <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_has_account?'>has_account?</span>
      <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_account'>account</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_build_account'>build_account</span>
      <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_create_account'>create_account</span> <span class='op'>=</span> <span class='kw'>false</span> <span class='comment'># to make sure that this code is nut run twice.
</span>      <span class='kw'>return</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_account'>account</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>
  <span class='id identifier rubyid_private'>private</span> <span class='symbol'>:build_account_if_requested</span>


  <span class='comment'># Groups
</span>  <span class='comment'># ------------------------------------------------------------------------------------------
</span>
  <span class='comment'># This returns all groups the user is currently a member of. In terms of the DAG model,
</span>  <span class='comment'># this method returns all ancestor groups.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_groups'>groups</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_ancestor_groups'>ancestor_groups</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_add_to_group_if_requested'>add_to_group_if_requested</span>
    <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_add_to_group'>add_to_group</span>
      <span class='id identifier rubyid_group'>group</span> <span class='op'>=</span> <span class='id identifier rubyid_add_to_group'>add_to_group</span> <span class='kw'>if</span> <span class='id identifier rubyid_add_to_group'>add_to_group</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span> <span class='const'>Group</span>
      <span class='id identifier rubyid_group'>group</span> <span class='op'>=</span> <span class='const'>Group</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span> <span class='id identifier rubyid_add_to_group'>add_to_group</span> <span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_add_to_group'>add_to_group</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='kw'>unless</span> <span class='id identifier rubyid_group'>group</span>
      <span class='const'>UserGroupMembership</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span> <span class='label'>user:</span> <span class='kw'>self</span><span class='comma'>,</span> <span class='label'>group:</span> <span class='id identifier rubyid_group'>group</span> <span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_group'>group</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_private'>private</span> <span class='symbol'>:add_to_group_if_requested</span>


  <span class='comment'># Corporations
</span>  <span class='comment'># ------------------------------------------------------------------------------------------
</span>
  <span class='comment'># This returns all corporations of the user. The Corporation model inherits from the Group
</span>  <span class='comment'># model. corporations are child_groups of the corporations_parent_group in the DAG.
</span>  <span class='comment'>#
</span>  <span class='comment'>#   everyone
</span>  <span class='comment'>#      |----- corporations_parent
</span>  <span class='comment'>#      |                |---------- corporation_a      &lt;----
</span>  <span class='comment'>#      |                |                |--- ...           |--- These are corporations
</span>  <span class='comment'>#      |                |---------- corporation_b      &lt;----
</span>  <span class='comment'>#      |                                 |--- ...
</span>  <span class='comment'>#      |----- other_group_1
</span>  <span class='comment'>#      |----- other_group_2
</span>  <span class='comment'>#
</span>  <span class='comment'># Warning!
</span>  <span class='comment'># This method does not distinguish between regular members and guest members.
</span>  <span class='comment'># If a user is only guest in a corporation, `user.corporations` WILL list this corporation.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_corporations'>corporations</span>
    <span class='id identifier rubyid_my_corporations'>my_corporations</span> <span class='op'>=</span> <span class='lparen'>(</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_ancestor_groups'>ancestor_groups</span> <span class='op'>&amp;</span> <span class='const'>Group</span><span class='period'>.</span><span class='id identifier rubyid_corporations'>corporations</span> <span class='rparen'>)</span> <span class='kw'>if</span> <span class='const'>Group</span><span class='period'>.</span><span class='id identifier rubyid_corporations_parent'>corporations_parent</span>
    <span class='id identifier rubyid_my_corporations'>my_corporations</span> <span class='op'>=</span> <span class='id identifier rubyid_my_corporations'>my_corporations</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_group'>group</span><span class='op'>|</span> <span class='id identifier rubyid_group'>group</span><span class='period'>.</span><span class='id identifier rubyid_becomes'>becomes</span><span class='lparen'>(</span> <span class='const'>Corporation</span> <span class='rparen'>)</span> <span class='rbrace'>}</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_my_corporations'>my_corporations</span>
  <span class='kw'>end</span>


  <span class='comment'># Status Groups
</span>  <span class='comment'># ------------------------------------------------------------------------------------------
</span>
  <span class='comment'># This returns all status groups of the user, i.e. groups that represent the member
</span>  <span class='comment'># status of the user in a corporation.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_status_groups'>status_groups</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_corporations'>corporations</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_corporation'>corporation</span><span class='op'>|</span>
      <span class='id identifier rubyid_corporation'>corporation</span><span class='period'>.</span><span class='id identifier rubyid_status_groups'>status_groups</span>
    <span class='kw'>end</span><span class='period'>.</span><span class='id identifier rubyid_flatten'>flatten</span>
  <span class='kw'>end</span>


  <span class='comment'># Memberships
</span>  <span class='comment'># ------------------------------------------------------------------------------------------
</span>
  <span class='comment'># Returns all UserGroupMemberships for this user.
</span>  <span class='comment'># Since this is an ActiveRelation object, one can chain other conditions, like:
</span>  <span class='comment'>#
</span>  <span class='comment'>#     some_user.memberships.with_deleted
</span>  <span class='comment'>#     some_user.memberships.in_the_past
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_memberships'>memberships</span>
    <span class='const'>UserGroupMembership</span><span class='period'>.</span><span class='id identifier rubyid_find_all_by_user'>find_all_by_user</span> <span class='kw'>self</span>
  <span class='kw'>end</span>


  <span class='comment'># Relationships
</span>  <span class='comment'># ------------------------------------------------------------------------------------------
</span>
  <span class='comment'># This returns all relationship opjects.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_relationships'>relationships</span>
    <span class='id identifier rubyid_relationships_as_first_user'>relationships_as_first_user</span> <span class='op'>+</span> <span class='id identifier rubyid_relationships_as_second_user'>relationships_as_second_user</span>
  <span class='kw'>end</span>


  <span class='comment'># Workflows
</span>  <span class='comment'># ------------------------------------------------------------------------------------------
</span>
  <span class='comment'># This method returns all workflows applicable for this user, i.e. this returns
</span>  <span class='comment'># all workflows of all groups the user is a member of.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_workflows'>workflows</span>
    <span class='id identifier rubyid_my_workflows'>my_workflows</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_groups'>groups</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_group'>group</span><span class='op'>|</span>
      <span class='id identifier rubyid_my_workflows'>my_workflows</span> <span class='op'>+=</span> <span class='id identifier rubyid_group'>group</span><span class='period'>.</span><span class='id identifier rubyid_child_workflows'>child_workflows</span>
    <span class='kw'>end</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_my_workflows'>my_workflows</span>
  <span class='kw'>end</span>


  <span class='comment'># Events
</span>  <span class='comment'># ------------------------------------------------------------------------------------------
</span>
  <span class='comment'># This method lists all upcoming events of the groups the user is member of.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_upcoming_events'>upcoming_events</span>
    <span class='const'>Event</span><span class='period'>.</span><span class='id identifier rubyid_upcoming'>upcoming</span><span class='period'>.</span><span class='id identifier rubyid_find_all_by_groups'>find_all_by_groups</span><span class='lparen'>(</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_groups'>groups</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_direct'>direct</span>
  <span class='kw'>end</span>


  <span class='comment'># Bookmarked Objects
</span>  <span class='comment'># ------------------------------------------------------------------------------------------
</span>
  <span class='comment'># This method lists all bookmarked objets of this user.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_bookmarked_objects'>bookmarked_objects</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_bookmarks'>bookmarks</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_bookmark'>bookmark</span><span class='op'>|</span> <span class='id identifier rubyid_bookmark'>bookmark</span><span class='period'>.</span><span class='id identifier rubyid_bookmarkable'>bookmarkable</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>



  <span class='comment'># User Identification and Authentification
</span>  <span class='comment'># ==========================================================================================
</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>UserMixins</span><span class='op'>::</span><span class='const'>Identification</span>

  <span class='comment'># This method tries to authenticate a user by a login_string and a password.
</span>  <span class='comment'># The user is identified by the login_string (see `self.identify`).
</span>  <span class='comment'>#
</span>  <span class='comment'># If the given password matches the identified user, the hereby authenticated user
</span>  <span class='comment'># is returned. Otherwise, this method returns `nil`.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_authenticate'>authenticate</span><span class='lparen'>(</span> <span class='id identifier rubyid_login_string'>login_string</span><span class='comma'>,</span> <span class='id identifier rubyid_password'>password</span> <span class='rparen'>)</span>
    <span class='const'>UserAccount</span><span class='period'>.</span><span class='id identifier rubyid_authenticate'>authenticate</span> <span class='id identifier rubyid_login_string'>login_string</span><span class='comma'>,</span> <span class='id identifier rubyid_password'>password</span>
  <span class='kw'>end</span>


  <span class='comment'># Roles and Rights
</span>  <span class='comment'># ==========================================================================================
</span>
  <span class='comment'># This method returns the role the user (self) has for a given
</span>  <span class='comment'># structureable object.
</span>  <span class='comment'>#
</span>  <span class='comment'># The roles may be :member, :admin or :main_admin.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_role_for'>role_for</span><span class='lparen'>(</span> <span class='id identifier rubyid_structureable'>structureable</span> <span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_structureable'>structureable</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span> <span class='symbol'>:parent_groups</span>
    <span class='kw'>return</span> <span class='symbol'>:main_admin</span> <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_main_admin_of?'>main_admin_of?</span> <span class='id identifier rubyid_structureable'>structureable</span>
    <span class='kw'>return</span> <span class='symbol'>:admin</span> <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_admin_of?'>admin_of?</span> <span class='id identifier rubyid_structureable'>structureable</span>
    <span class='kw'>return</span> <span class='symbol'>:member</span> <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_member_of?'>member_of?</span> <span class='id identifier rubyid_structureable'>structureable</span>
  <span class='kw'>end</span>

  <span class='comment'># Members
</span>  <span class='comment'># ------------------------------------------------------------------------------------------
</span>
  <span class='comment'># This method says whether the user (self) is a member of the given structureable
</span>  <span class='comment'># object. This may be used to determine if the user has, for example, the read to
</span>  <span class='comment'># read that object.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_member_of?'>member_of?</span><span class='lparen'>(</span> <span class='id identifier rubyid_structureable'>structureable</span> <span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_structureable'>structureable</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span> <span class='symbol'>:descendant_users</span>
    <span class='id identifier rubyid_structureable'>structureable</span><span class='period'>.</span><span class='id identifier rubyid_descendant_users'>descendant_users</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='kw'>self</span>
  <span class='kw'>end</span>

  <span class='comment'># Admins
</span>  <span class='comment'># ------------------------------------------------------------------------------------------
</span>
  <span class='comment'># This method finds all objects the user is an administrator of.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_admin_of'>admin_of</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_administrated_objects'>administrated_objects</span>
  <span class='kw'>end</span>

  <span class='comment'># This method verifies if the user is administrator of the given structureable object.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_admin_of?'>admin_of?</span><span class='lparen'>(</span> <span class='id identifier rubyid_structureable'>structureable</span> <span class='rparen'>)</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_admin_of'>admin_of</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_structureable'>structureable</span>
  <span class='kw'>end</span>

  <span class='comment'># This method returns all structureable objects the user is directly administrator of,
</span>  <span class='comment'># i.e. the user is a member of the administrators group of this object.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_directly_administrated_objects'>directly_administrated_objects</span><span class='lparen'>(</span> <span class='id identifier rubyid_role'>role</span> <span class='op'>=</span> <span class='symbol'>:admin</span> <span class='rparen'>)</span>
    <span class='id identifier rubyid_admin_group_flag'>admin_group_flag</span> <span class='op'>=</span> <span class='symbol'>:admins_parent</span> <span class='kw'>if</span> <span class='id identifier rubyid_role'>role</span> <span class='op'>==</span> <span class='symbol'>:admin</span>
    <span class='id identifier rubyid_admin_group_flag'>admin_group_flag</span> <span class='op'>=</span> <span class='symbol'>:main_admins_parent</span> <span class='kw'>if</span> <span class='id identifier rubyid_role'>role</span> <span class='op'>==</span> <span class='symbol'>:main_admin</span>
    <span class='id identifier rubyid_admin_groups'>admin_groups</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_ancestor_groups'>ancestor_groups</span><span class='period'>.</span><span class='id identifier rubyid_find_all_by_flag'>find_all_by_flag</span><span class='lparen'>(</span> <span class='id identifier rubyid_admin_group_flag'>admin_group_flag</span> <span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_admin_groups'>admin_groups</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span> <span class='op'>&gt;</span> <span class='int'>0</span>
      <span class='id identifier rubyid_objects'>objects</span> <span class='op'>=</span> <span class='id identifier rubyid_admin_groups'>admin_groups</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_admin_group'>admin_group</span><span class='op'>|</span>
        <span class='id identifier rubyid_admin_group'>admin_group</span><span class='period'>.</span><span class='id identifier rubyid_administrated_object'>administrated_object</span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># This method returns all structureable objects the user is administrator of.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_administrated_objects'>administrated_objects</span><span class='lparen'>(</span> <span class='id identifier rubyid_role'>role</span> <span class='op'>=</span> <span class='symbol'>:admin</span> <span class='rparen'>)</span>
    <span class='id identifier rubyid_objects'>objects</span> <span class='op'>=</span> <span class='id identifier rubyid_directly_administrated_objects'>directly_administrated_objects</span><span class='lparen'>(</span> <span class='id identifier rubyid_role'>role</span> <span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_objects'>objects</span>
      <span class='id identifier rubyid_objects'>objects</span> <span class='op'>+=</span> <span class='id identifier rubyid_objects'>objects</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_directly_administrated_object'>directly_administrated_object</span><span class='op'>|</span>
        <span class='id identifier rubyid_directly_administrated_object'>directly_administrated_object</span><span class='period'>.</span><span class='id identifier rubyid_descendants'>descendants</span>
      <span class='kw'>end</span><span class='period'>.</span><span class='id identifier rubyid_flatten'>flatten</span>
      <span class='id identifier rubyid_objects'>objects</span>
    <span class='kw'>else</span>
      <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># Main Admins
</span>  <span class='comment'># ------------------------------------------------------------------------------------------
</span>
  <span class='comment'># This method says whether the user (self) is a main admin of the given
</span>  <span class='comment'># structureable object.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_main_admin_of?'>main_admin_of?</span><span class='lparen'>(</span> <span class='id identifier rubyid_structureable'>structureable</span> <span class='rparen'>)</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_administrated_objects'>administrated_objects</span><span class='lparen'>(</span> <span class='symbol'>:main_admin</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_structureable'>structureable</span>
  <span class='kw'>end</span>


  <span class='comment'># Guest Status
</span>  <span class='comment'># ==========================================================================================
</span>
  <span class='comment'># This method says if the user (self) is a guest of the given group.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_guest_of?'>guest_of?</span><span class='lparen'>(</span> <span class='id identifier rubyid_group'>group</span> <span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_group'>group</span><span class='period'>.</span><span class='id identifier rubyid_find_guests_parent_group'>find_guests_parent_group</span>
    <span class='id identifier rubyid_group'>group</span><span class='period'>.</span><span class='id identifier rubyid_guests'>guests</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='kw'>self</span>
  <span class='kw'>end</span>


  <span class='comment'># Finder Methods
</span>  <span class='comment'># ==========================================================================================
</span>
  <span class='comment'># This method returns the first user matching the given title.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_find_by_title'>find_by_title</span><span class='lparen'>(</span> <span class='id identifier rubyid_title'>title</span> <span class='rparen'>)</span>
    <span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_user'>user</span><span class='op'>|</span> <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_title'>title</span> <span class='op'>==</span> <span class='id identifier rubyid_title'>title</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
  <span class='kw'>end</span>

  <span class='comment'># This method finds all users having the given name attribute.
</span>  <span class='comment'># notice: case insensitive
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_find_all_by_name'>find_all_by_name</span><span class='lparen'>(</span> <span class='id identifier rubyid_name'>name</span> <span class='rparen'>)</span> <span class='comment'># TODO: Test this; # TODO: optimize using where
</span>    <span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_user'>user</span><span class='op'>|</span> <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span> <span class='op'>==</span> <span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='comment'># This method finds all users having the given email attribute.
</span>  <span class='comment'># notice: case insensitive
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_find_all_by_email'>find_all_by_email</span><span class='lparen'>(</span> <span class='id identifier rubyid_email'>email</span> <span class='rparen'>)</span> <span class='comment'># TODO: Test this; # TODO: optimize using where
</span>    <span class='id identifier rubyid_email_fields'>email_fields</span> <span class='op'>=</span> <span class='const'>ProfileField</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span> <span class='label'>type:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ProfileFieldTypes::Email</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>value:</span> <span class='id identifier rubyid_email'>email</span> <span class='rparen'>)</span>
    <span class='id identifier rubyid_matching_users'>matching_users</span> <span class='op'>=</span> <span class='id identifier rubyid_email_fields'>email_fields</span><span class='period'>
</span><span class='id identifier rubyid_      .select'>      .select</span><span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_ef'>ef</span><span class='op'>|</span> <span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_profileable_type'>profileable_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>User</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span><span class='period'>
</span><span class='id identifier rubyid_      .collect'>      .collect</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_ef'>ef</span><span class='op'>|</span> <span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_profileable'>profileable</span> <span class='rbrace'>}</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_matching_users'>matching_users</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span>
    <span class='comment'>#User.all.select { |user| user.email &amp;&amp; user.email.downcase == email.downcase }
</span>  <span class='kw'>end</span>

  <span class='comment'># Debug Helpers
</span>  <span class='comment'># ==========================================================================================
</span>
  <span class='comment'># The string returned by this method represents the user in the rails console.
</span>  <span class='comment'># For example, if you type `User.all` in the console, the answer would be:
</span>  <span class='comment'>#
</span>  <span class='comment'>#    User: alias_of_the_first_user, User: alias_of_the_second_user, ...
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_inspect'>inspect</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>User: </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_alias'>alias</span>
  <span class='kw'>end</span>

<span class='kw'>end</span></pre></div></div>

    <div id="footer">
  Generated on Sat Mar 23 00:23:01 2013 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.5.2 (ruby-2.0.0).
</div>

  </body>
</html>
